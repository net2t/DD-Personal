name: DamaDam Msg + Post

on:
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 240   # // max 4 hours (01â€“05 GMT)

    steps:
      - uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install Chrome
        run: |
          sudo apt-get update
          sudo apt-get install -y google-chrome-stable

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Write Google credentials
        env:
          GOOGLE_CREDENTIALS_JSON: ${{ secrets.GOOGLE_CREDENTIALS_JSON }}
        run: |
          python - <<'PY'
          import os
          data = os.getenv('GOOGLE_CREDENTIALS_JSON', '')
          if not data:
              raise SystemExit('Missing secret GOOGLE_CREDENTIALS_JSON')
          with open('credentials.json', 'w', encoding='utf-8') as f:
              f.write(data)
          PY

      - name: Run Bot (Msg + Post)
        env:
          DD_LOGIN_EMAIL: ${{ secrets.DD_LOGIN_EMAIL }}
          DD_LOGIN_PASS:  ${{ secrets.DD_LOGIN_PASS }}
          DD_SHEET_ID:    ${{ secrets.DD_SHEET_ID }}
        run: |
          python main.py --mode msg
          python main.py --mode post

      - name: Upload Logs
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: damadam-msg-post-logs-${{ github.run_number }}
          path: logs/*.log
